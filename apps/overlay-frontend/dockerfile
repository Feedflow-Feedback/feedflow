FROM node:20-alpine

# Enable pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

WORKDIR /app

# Copy everything
COPY . .

# Install all dependencies from root
RUN pnpm install

# Build the overlay-frontend app only
RUN pnpm --filter=overlay-frontend... run build

# Serve the built app
RUN pnpm add -g serve
CMD ["serve", "apps/overlay-frontend/dist", "-l", "4173"]